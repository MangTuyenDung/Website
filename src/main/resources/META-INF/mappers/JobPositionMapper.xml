<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="vn.mangtuyendung.persistence.repositories.member.JobPositionRepository">

    <cache type="org.mybatis.caches.ehcache.EhcacheCache"/>

    <select id="findById" resultType="JobPositionDomain" flushCache="false" useCache="true">
        SELECT 
        ID, PROFILE_ID as profileId,
        COMPANY_NAME as companyName, 
        TITLE, ADDRESS, 
        CURRENT_HERE as currentHere, 
        START_DATE_MONTH as startDateMonth, 
        END_DATE_MONTH as endDateMonth, 
        START_DATE_YEAR as startDateyear, 
        END_DATE_YEAR as endDateYear, 
        DESCRIPTION, CREATED, UPDATED
        FROM job_position
        WHERE ID = #{id}
    </select>
    
    <select id="findByProfileId" resultType="JobPositionDomain" flushCache="false" useCache="true">
        SELECT 
        ID, PROFILE_ID as profileId,
        COMPANY_NAME as companyName, 
        TITLE, ADDRESS,
        CURRENT_HERE as currentHere, 
        START_DATE_MONTH as startDateMonth, 
        END_DATE_MONTH as endDateMonth, 
        START_DATE_YEAR as startDateyear, 
        END_DATE_YEAR as endDateYear, 
        DESCRIPTION, CREATED, UPDATED
        FROM job_position
        WHERE PROFILE_ID = #{profileId}
        ORDER BY CREATED DESC
    </select>
    
    <insert id="save" parameterType="JobPositionDomain" flushCache="true">
        INSERT INTO job_position
        (PROFILE_ID, COMPANY_NAME, TITLE, ADDRESS, CURRENT_HERE, START_DATE_MONTH, END_DATE_MONTH, START_DATE_YEAR, END_DATE_YEAR, DESCRIPTION, CREATED)
        VALUES
        (#{profileId},#{companyName},#{title},#{address},#{currentHere},#{startDateMonth},#{endDateMonth},#{startDateYear},#{endDateYear},#{description},#{created})
        <selectKey keyProperty="id" resultType="long" order="AFTER">
            SELECT LAST_INSERT_ID();
        </selectKey>
    </insert>
    
    <update id="update" flushCache="true">
        UPDATE job_position
        SET
        COMPANY_NAME = #{companyName},
        TITLE = #{title},
        ADDRESS = #{address},
        CURRENT_HERE = #{currentHere},
        START_DATE_MONTH = #{startDateMonth},
        END_DATE_MONTH = #{endDateMonth},
        START_DATE_YEAR = #{startDateYear},
        END_DATE_YEAR = #{endDateYear},
        DESCRIPTION = #{description},
        UPDATED = #{updated} 
        WHERE ID = #{id}
        AND PROFILE_ID = #{profileId}
    </update>
    
    <delete id="delete" flushCache="true">
        DELETE FROM job_position 
        WHERE ID = #{id}
        AND PROFILE_ID = #{profileId}
    </delete>
</mapper>